<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Trader</title>
<style>
  body {margin:0;font-family:sans-serif;background:#121212;color:#fff;display:flex;flex-direction:column;align-items:center;}
  #welcome, #game {width:100%;max-width:400px;padding:20px;box-sizing:border-box;}
  #welcome {display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;}
  input {margin:5px 0;padding:10px;width:100%;border-radius:5px;border:none;}
  button {padding:10px 20px;margin:5px;border:none;border-radius:5px;background:#1abc9c;color:#fff;font-weight:bold;cursor:pointer;transition:0.3s;}
  button:hover {background:#16a085;}
  #game {display:none;flex-direction:column;align-items:center;}
  #balance-bar {width:100%;display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;padding:10px;background:#222;border-radius:10px;}
  #trader-canvas {width:100%;height:200px;background:#111;border-radius:10px;margin-bottom:10px;}
  #bet-line {width:100%;display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;padding:10px;background:#222;border-radius:10px;}
  #players {width:100%;max-height:150px;overflow-y:auto;background:#1a1a1a;padding:10px;border-radius:10px;}
  .player {display:flex;justify-content:space-between;margin-bottom:5px;font-size:14px;}
  .modal {position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:flex;justify-content:center;align-items:center;opacity:0;pointer-events:none;transition:0.3s;}
  .modal.active {opacity:1;pointer-events:auto;}
  .modal-content {background:#222;padding:20px;border-radius:10px;text-align:center;animation:fadeIn 0.3s;}
  @keyframes fadeIn {from {transform:scale(0.8);opacity:0;} to {transform:scale(1);opacity:1;}}
</style>
</head>
<body>

<div id="welcome">
  <h2>Bem-vindo ao Mini Trader</h2>
  <input type="text" id="username" placeholder="Nome">
  <input type="text" id="phone" placeholder="Número de celular">
  <button id="enter">Entrar</button>
</div>

<div id="game">
  <div id="balance-bar">
    <span>Saldo: <span id="balance">100.00</span> MT</span>
    <span>Atual X: <span id="current-x">1.00</span></span>
  </div>

  <canvas id="trader-canvas"></canvas>

  <div id="bet-line">
    <input type="number" id="bet-value" placeholder="Valor da aposta" min="8">
    <button id="cashout">Saque</button>
  </div>

  <div id="players"></div>
</div>

<div id="cashout-modal" class="modal">
  <div class="modal-content">
    <h3>Parabéns, ganhaste <span id="won-amount">0</span> MZN!</h3>
    <button id="register-button">REGISTAR-SE</button>
  </div>
</div>

<script>
  let balance = 100;
  let multiplier = 1.0;
  let flying = false;
  let players = [];
  let blocked = false;
  const blockDuration = 10 * 60 * 1000; // 10 minutos

  const welcome = document.getElementById('welcome');
  const game = document.getElementById('game');
  const balanceEl = document.getElementById('balance');
  const currentXEl = document.getElementById('current-x');
  const betValueInput = document.getElementById('bet-value');
  const cashoutBtn = document.getElementById('cashout');
  const cashoutModal = document.getElementById('cashout-modal');
  const wonAmountEl = document.getElementById('won-amount');
  const registerButton = document.getElementById('register-button');
  const playersDiv = document.getElementById('players');
  const enterBtn = document.getElementById('enter');

  const canvas = document.getElementById('trader-canvas');
  const ctx = canvas.getContext('2d');

  canvas.width = canvas.offsetWidth;
  canvas.height = canvas.offsetHeight;

  let points = [];
  const maxPoints = 100;

  enterBtn.addEventListener('click', () => {
    const name = document.getElementById('username').value;
    const phone = document.getElementById('phone').value;
    if(name && phone){
      welcome.style.display = 'none';
      game.style.display = 'block';
      startFlight();
      generatePlayers();
    } else {
      alert('Preencha nome e celular.');
    }
  });

  function startFlight(){
    if(blocked) return;
    flying = true;
    multiplier = 1.0;
    points = [];
    const startTime = Date.now();
    const crashPoint = Math.random()*3+1.5;

    function animate(){
      if(!flying) return;
      const elapsed = Date.now()-startTime;
      multiplier = 1 + elapsed/2000 + Math.sin(elapsed/500)*0.3;
      if(multiplier >= crashPoint){
        crash();
        return;
      }
      currentXEl.textContent = multiplier.toFixed(2);
      points.push(multiplier);
      if(points.length>maxPoints) points.shift();
      drawGraph();
      requestAnimationFrame(animate);
    }
    animate();
  }

  function drawGraph(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.beginPath();
    ctx.moveTo(0,canvas.height);
    for(let i=0;i<points.length;i++){
      const x = i*(canvas.width/maxPoints);
      const y = canvas.height - (points[i]/Math.max(...points))*canvas.height*0.6;
      ctx.lineTo(x,y);
    }
    ctx.strokeStyle = '#0f0';
    ctx.lineWidth = 2;
    ctx.stroke();
  }

  function crash(){
    flying=false;
    multiplier=1.0;
    currentXEl.textContent = multiplier.toFixed(2);
    points=[];
    drawGraph();
    setTimeout(startFlight, 30000); // 30s até próximo voo
  }

  cashoutBtn.addEventListener('click', () => {
    if(blocked) return;
    const bet = parseFloat(betValueInput.value);
    if(isNaN(bet) || bet<8 || bet>balance){
      alert('Valor inválido.');
      return;
    }
    flying=false;
    const winAmount = bet*multiplier;
    balance += winAmount - bet;
    balanceEl.textContent = balance.toFixed(2);
    wonAmountEl.textContent = winAmount.toFixed(2);
    cashoutModal.classList.add('active');
    addPlayerWin(winAmount, multiplier);

    blocked = true;
    setTimeout(()=>{
      blocked = false;
      startFlight();
    }, blockDuration);
  });

  registerButton.addEventListener('click', () => {
    window.location.href = 'https://go.aff.betvivo.partners/wydkfw29';
  });

  function generatePlayers(){
    for(let i=0;i<50;i++){
      const p = {
        name: 'Jogador'+(i+1),
        bet: Math.floor(Math.random()*50+8),
        x: (Math.random()*5+1).toFixed(2)
      };
      players.push(p);
      const div = document.createElement('div');
      div.className='player';
      div.innerHTML=`<span>${p.name}</span><span>Aposta: ${p.bet} MT</span><span>X: ${p.x}</span>`;
      playersDiv.appendChild(div);
    }
  }

  function addPlayerWin(amount, x){
    const div = document.createElement('div');
    div.className='player';
    div.innerHTML=`<span>Você</span><span>Aposta: ${betValueInput.value} MT</span><span>X: ${x.toFixed(2)}</span>`;
    playersDiv.prepend(div);
  }

  cashoutModal.addEventListener('click', (e)=>{
    if(e.target===cashoutModal){
      cashoutModal.classList.remove('active');
    }
  });
</script>

</body>
</html>
